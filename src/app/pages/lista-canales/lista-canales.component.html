<!-- Skip link for keyboard users -->
<a class="skip-link sr-only focus:not-sr-only" href="#main-content"
  >Saltar al contenido</a
>

<main
  id="main-content"
  class="lista-canales root flex-1 py-8 px-4 sm:px-8 lg:px-12"
  role="main"
  aria-labelledby="page-title"
>
  <section class="top">
    <app-nav-bar></app-nav-bar>
    <app-banner *ngIf="destacada" [data]="destacada" lazy="true"></app-banner>
  </section>

  <section class="intro mt-6 max-w-4xl mx-auto text-gray-600">
    <h1 id="page-title" class="text-xl font-semibold text-gray-100">
      Listado de canales de televisión en España
    </h1>
    <p class="mt-3 text-sm leading-relaxed">
      Consulta la programación de los principales canales españoles. Filtra por
      TDT, Movistar+, canales online o autonómicos.
    </p>
  </section>

  <!-- JSON-LD para SEO -->
  <div *ngIf="safeLdHtml" [innerHTML]="safeLdHtml"></div>

  <!-- Top channels (crawlable list for SEO) -->
  <section
    *ngIf="topChannels?.length"
    class="top-channels mt-6 max-w-4xl mx-auto text-sm text-gray-300"
    aria-labelledby="top-channels-title"
  >
    <h2 id="top-channels-title" class="text-base font-semibold text-gray-100">
      Canales populares
    </h2>
    <p class="sr-only">
      Listado de canales populares para facilitar el rastreo a buscadores
    </p>
    <ul class="grid grid-cols-2 sm:grid-cols-3 gap-2">
      <li *ngFor="let c of topChannels">
        <a
          [href]="
            (url_web && (url_web[c.id]?.url || url_web[c.name]?.url)) || '#'
          "
          rel="noopener noreferrer"
          class="text-gray-300 hover:text-red-400 underline-offset-2 focus:outline-none focus:ring-2 focus:ring-red-400"
          >{{ c.name || c.nombre || c.title || c.titulo }}</a
        >
      </li>
    </ul>
  </section>

  <!-- Reusable section template: title, description, navigation and lazy slider -->
  <ng-container
    *ngFor="
      let s of [
        { key: 'tdt', title: 'Canales TDT España', list: canales_tdt },
        {
          key: 'movistar',
          title: 'Canales exclusivos de Movistar+',
          list: canales_m
        },
        {
          key: 'online',
          title: 'Canales de TV online en España',
          list: canales_cable
        },
        {
          key: 'autonomo',
          title: 'Canales Autonómicos España',
          list: canales_auto
        },
        { key: 'deporte', title: 'Canales Deportes España', list: canales_dep }
      ]
    "
  >
    <section
      #channelSection
      class="channel-section mt-8"
      [attr.data-key]="s.key"
      [attr.aria-labelledby]="'section-' + s.key + '-title'"
    >
      <div class="flex items-center justify-between">
        <h2
          id="{{ 'section-' + s.key + '-title' }}"
          class="font-semibold text-gray-100 text-base"
        >
          {{ s.title }}
        </h2>
        <div class="controls flex items-center space-x-2 text-gray-400">
          <button
            aria-label="Anterior"
            class="btn-nav"
            (click)="prevFor(s.key)"
          >
            ‹
          </button>
          <button
            aria-label="Siguiente"
            class="btn-nav"
            (click)="nextFor(s.key)"
          >
            ›
          </button>
        </div>
      </div>

      <p class="mt-3 text-sm text-gray-400">
        {{ s.title }} — explora la programación y encuentra tus canales
        favoritos.
      </p>

      <div class="mt-4">
        <!-- skeleton while loading -->
        <div *ngIf="cargando" class="skeleton-grid" aria-hidden="true">
          <div class="s-item" *ngFor="let i of [1, 2, 3, 4, 5]"></div>
        </div>

        <!-- Lazy render slider only on browser and when sliderVisible flag is true -->
        <ng-container
          *ngIf="!cargando && (isBrowser ? sliderVisible[s.key] : true)"
        >
          <app-slider
            [key]="s.key"
            [programas]="s.list"
            variant="canales"
            [attr.data-lazy]="isBrowser ? 'true' : 'false'"
            [attr.aria-label]="'Carrusel de ' + s.title"
          ></app-slider>
        </ng-container>
      </div>
    </section>
  </ng-container>
</main>
